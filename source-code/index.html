<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="displayTitle">SapiBersinar: Lihat Kode</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K5JQPNMVEF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-K5JQPNMVEF'); // Your GA4 Measurement ID
    </script>
    
    <!-- SEO Meta Tags for SapiBersinar Code Viewer Page -->
    <meta name="description" content="Lihat dan salin potongan kode yang dibagikan melalui SapiBersinar, dengan penyorotan sintaks otomatis untuk berbagai bahasa pemrograman.">
    <meta name="keywords" content="lihat kode, penampil kode, syntax highlight, berbagi kode, SapiBersinar, kode lua, kode javascript, kode python">
    <meta name="author" content="SapiBersinar">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social Media Meta Tags (untuk berbagi di media sosial) -->
    <meta property="og:title" content="Lihat Kode di SapiBersinar">
    <meta property="og:description" content="Lihat dan salin potongan kode yang dibagikan melalui SapiBersinar, dengan penyorotan sintaks otomatis untuk berbagai bahasa pemrograman.">
    <meta property="og:url" content="https://sapibersinar.github.io/source-code/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://placehold.co/1200x630/007bff/ffffff?text=Lihat+Kode"> <!-- Placeholder image for social media share -->
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Preload file.json for faster loading of code keys -->
    <link rel="preload" href="https://sapibersinar.github.io/file.json" as="fetch" crossorigin>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Highlight.js CSS for light theme (default) -->
    <link id="highlightTheme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Light mode background: light blue-purple gradient */
            background: linear-gradient(135deg, #e0f2fe 0%, #e8eaf6 100%); /* Light blue to very light purple */
            transition: background-color 0.3s ease; /* Smooth transition */
        }
        .dark body {
            background-color: #1a202c; /* Dark mode background color */
        }
        .container {
            background-color: #ffffff; /* Light mode container background color */
            transition: background-color 0.3s ease; /* Smooth transition */
        }
        .dark .container {
            background-color: #2d3748; /* Dark mode container background color */
        }
        /* Text color adjustments for dark mode */
        .dark .text-gray-800, .dark .text-gray-100 {
            color: #e2e8f0;
        }
        .dark .text-gray-600, .dark .text-gray-300 {
            color: #cbd5e0;
        }
        /* Button adjustments for dark mode */
        .dark .bg-blue-600 {
            background-color: #63b3ed;
        }
        .dark .hover\:bg-blue-700:hover {
            background-color: #4299e1;
        }
        .dark .bg-gray-200 {
            background-color: #4a5568; /* Darker gray button for dark mode */
        }
        .dark .hover\:bg-gray-300:hover {
            background-color: #636b77;
        }

        /* --- STYLING FOR NEATER CODE DISPLAY --- */
        pre {
            /* Ensure sufficient padding around the code */
            padding: 1.5rem;
            border-radius: 0.75rem; /* Slightly more rounded */
            /* Use shadow to distinguish code block */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow-x: auto; /* Enable horizontal scroll for very long lines */
            /* Ensure code lines don't break suddenly and wrap if necessary */
            white-space: pre-wrap; /* Allows wrapping */
            word-break: break-word; /* Breaks words if necessary to prevent overflow */
            line-height: 1.6; /* Increase line spacing */
            background-color: #f7fafc; /* Default background color for code block in light mode */
            border: 1px solid #e2e8f0; /* Subtle light border */
        }
        .dark pre {
            background-color: #1f2937; /* Background color for code block in dark mode (slightly darker than container) */
            border-color: #4a5568;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12); /* Slightly darker shadow */
        }
        code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.925rem; /* Slightly larger font size */
        }

        /* Scrollbar styling (optional, for cleaner look in supported browsers) */
        pre::-webkit-scrollbar {
            height: 8px;
            background-color: #f1f1f1;
            border-radius: 4px;
        }
        pre::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 4px;
        }
        .dark pre::-webkit-scrollbar {
            background-color: #2d3748;
        }
        .dark pre::-webkit-scrollbar-thumb {
            background-color: #4a5568;
        }

        /* Copy confirmation message adjustments */
        .dark #copyMessage {
            color: #68d391;
        }

        /* Spinner Styling */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2563eb; /* Blue spinner */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }
        .dark .spinner {
            border-color: rgba(255, 255, 255, 0.2);
            border-left-color: #60a5fa; /* Lighter blue for dark mode */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-gray-800 dark:to-gray-900 transition-colors duration-300">
    <!-- Theme toggle button -->
    <div class="absolute top-4 right-4">
        <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300">
            ‚òÄÔ∏è
        </button>
    </div>

    <div class="container bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-4xl transition-colors duration-300">
        <h1 id="codeTitle" class="text-3xl font-bold text-center text-gray-800 dark:text-gray-100 mb-6 sm:mb-8">Memuat Kode...</h1>
        <p id="codeTypeDisplay" class="text-center text-gray-600 dark:text-gray-300 mb-4"></p>

        <!-- Code display area -->
        <div class="relative mb-6">
            <pre class="overflow-auto rounded-lg shadow-inner border border-gray-200 dark:border-gray-700 transition-colors duration-300">
                <code id="codeContent" class="language-plaintext"></code>
            </pre>
            <!-- Spinner will appear here -->
            <div id="loadingSpinner" class="spinner absolute inset-0 m-auto"></div>
            <button id="copyCodeButton" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 p-2 rounded-md text-sm font-semibold opacity-75 hover:opacity-100 transition duration-200 transform hover:scale-105">
                Salin Kode
            </button>
        </div>

        <!-- Copy confirmation message -->
        <div id="copyMessage" class="hidden text-center text-sm font-medium text-green-700 dark:text-green-400 mt-2">
            Kode berhasil disalin!
        </div>

        <!-- Button to go back to Creator -->
        <div class="text-center mt-6">
            <a href="../create/source-code/" class="inline-block bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200 transform hover:scale-105">
                Buat Kode Lain
            </a>
        </div>
    </div>

    <!-- Highlight.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Highlight.js language definitions (loading common ones) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script> <!-- For HTML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/markdown.min.js"></script>


    <script>
        const codeTitle = document.getElementById('codeTitle');
        const codeTypeDisplay = document.getElementById('codeTypeDisplay');
        const codeContent = document.getElementById('codeContent');
        const copyCodeButton = document.getElementById('copyCodeButton');
        const copyMessage = document.getElementById('copyMessage');
        const displayTitle = document.getElementById('displayTitle');
        const highlightThemeLink = document.getElementById('highlightTheme');
        const themeToggle = document.getElementById('themeToggle');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Fungsi untuk menyembunyikan pesan setelah durasi
        function hideMessage(element) {
            setTimeout(() => {
                element.classList.add('hidden');
            }, 3000); // Sembunyikan setelah 3 detik
        }

        // Fungsi untuk menampilkan spinner
        function showSpinner() {
            codeContent.style.display = 'none'; // Sembunyikan konten kode
            copyCodeButton.style.display = 'none'; // Sembunyikan tombol salin
            loadingSpinner.style.display = 'block'; // Tampilkan spinner
            codeTitle.textContent = "Memuat Kode..."; // Pastikan judul loading
            codeTypeDisplay.textContent = ""; // Kosongkan jenis
            codeContent.textContent = ""; // Kosongkan konten
        }

        // Fungsi untuk menyembunyikan spinner
        function hideSpinner() {
            loadingSpinner.style.display = 'none'; // Sembunyikan spinner
            codeContent.style.display = 'block'; // Tampilkan konten kode
            copyCodeButton.style.display = 'block'; // Tampilkan tombol salin
        }

        // Atur preferensi tema saat halaman dimuat
        function applyThemeOnLoad() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                // Ubah tema highlight.js menjadi gelap
                highlightThemeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css';
            } else {
                document.documentElement.classList.remove('dark');
                // Ubah tema highlight.js menjadi terang (github.min.css adalah tema terang)
                highlightThemeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
            }
            updateThemeToggleIcon();
        }

        // Fungsi untuk memperbarui ikon pengalih tema
        function updateThemeToggleIcon() {
            if (document.documentElement.classList.contains('dark')) {
                themeToggle.textContent = 'üåô'; // Ikon bulan untuk mode gelap
            } else {
                themeToggle.textContent = '‚òÄÔ∏è'; // Ikon matahari untuk mode terang
            }
        }

        // Inisialisasi tema saat halaman dimuat
        applyThemeOnLoad();

        // Logika pengalih tema
        themeToggle.addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                highlightThemeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                highlightThemeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css';
            }
            updateThemeToggleIcon();
            // Sorot ulang kode setelah perubahan tema untuk memastikan warna diperbarui
            if (codeContent.textContent.trim() !== '' && codeTitle.textContent !== "Memuat Kode...") { // Hanya sorot ulang jika ada konten
                 hljs.highlightElement(codeContent);
            }
        });

        // Muat data dari URL saat halaman dimuat
        window.onload = async () => {
            showSpinner(); // Tampilkan spinner segera saat halaman dimuat
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            const keyParam = urlParams.get('key');

            try {
                if (dataParam) {
                    // Logika existing untuk data base64
                    const decodedData = decodeURIComponent(atob(dataParam));
                    const parsedData = JSON.parse(decodedData);

                    if (parsedData.title) {
                        codeTitle.textContent = parsedData.title;
                        displayTitle.textContent = `Kode: ${parsedData.title}`;
                    } else {
                        codeTitle.textContent = "Kode Tanpa Judul";
                        displayTitle.textContent = "Kode Tanpa Judul";
                    }

                    if (parsedData.type) {
                        codeTypeDisplay.textContent = `Jenis: ${parsedData.type.toUpperCase()}`;
                        codeContent.className = `language-${parsedData.type.toLowerCase()}`;
                    } else {
                        codeTypeDisplay.textContent = "Jenis: Tidak Diketahui";
                        codeContent.className = 'language-plaintext';
                    }

                    if (parsedData.code) {
                        codeContent.textContent = parsedData.code;
                        hljs.highlightElement(codeContent);
                    } else {
                        codeContent.textContent = "Tidak ada kode untuk ditampilkan.";
                    }

                } else if (keyParam) {
                    // Logika untuk mengambil dari sapibersinar.github.io/file.json
                    codeTitle.textContent = "Memuat Kode dari URL..."; // Perbarui judul loading yang lebih spesifik
                    
                    const fileJsonUrl = 'https://sapibersinar.github.io/file.json'; // URL ke file JSON Anda
                    const responseFileJson = await fetch(fileJsonUrl);
                    if (!responseFileJson.ok) {
                        throw new Error(`Gagal memuat daftar kode dari ${fileJsonUrl} (Status: ${responseFileJson.status} ${responseFileJson.statusText}). Periksa apakah file ada dan dapat diakses.`);
                    }
                    const fileJsonContent = await responseFileJson.json();

                    const codeUrl = fileJsonContent[keyParam];

                    if (codeUrl) {
                        const responseCode = await fetch(codeUrl);
                        if (!responseCode.ok) {
                            throw new Error(`Gagal memuat kode dari ${codeUrl} (Status: ${responseCode.status} ${responseCode.statusText}). Periksa apakah URL kode ini valid dan dapat diakses.`);
                        }
                        const code = await responseCode.text();

                        const title = keyParam.replace(/\+/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                        const urlParts = codeUrl.split('.');
                        const type = urlParts.length > 1 ? urlParts.pop() : 'plaintext';

                        codeTitle.textContent = title;
                        displayTitle.textContent = `Kode: ${title}`;
                        codeTypeDisplay.textContent = `Jenis: ${type.toUpperCase()}`;
                        codeContent.className = `language-${type.toLowerCase()}`;
                        codeContent.textContent = code;
                        hljs.highlightElement(codeContent);

                    } else {
                        codeTitle.textContent = "Kode Tidak Ditemukan";
                        codeTypeDisplay.textContent = "";
                        codeContent.textContent = `Kunci '${keyParam}' tidak ditemukan dalam daftar kode di ${fileJsonUrl}. Pastikan Anda menggunakan kunci yang benar.`;
                    }

                } else {
                    // Jika tidak ada parameter 'data' atau 'key'
                    codeTitle.textContent = "Tidak Ada Kode Ditemukan";
                    codeTypeDisplay.textContent = "";
                    codeContent.textContent = "URL tidak memiliki parameter 'data' yang berisi kode untuk ditampilkan atau parameter 'key' untuk mengambil kode dari file.json.";
                }
            } catch (e) {
                codeTitle.textContent = "Kesalahan Memuat Kode";
                codeTypeDisplay.textContent = "";
                codeContent.textContent = `Terjadi kesalahan fatal saat memuat kode: ${e.message}`;
                console.error("Error loading code:", e);
            } finally {
                hideSpinner(); // Sembunyikan spinner setelah semua proses selesai
            }
        };

        // Salin kode ke clipboard
        copyCodeButton.addEventListener('click', () => {
            const codeToCopy = codeContent.textContent;
            const textArea = document.createElement("textarea");
            textArea.value = codeToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    const originalButtonText = copyCodeButton.textContent;
                    copyCodeButton.textContent = 'Disalin!';
                    copyMessage.classList.remove('hidden');
                    hideMessage(copyMessage);
                    setTimeout(() => {
                        copyCodeButton.textContent = originalButtonText;
                    }, 3000);
                } else {
                    console.error("Gagal menyalin kode.");
                }
            } catch (err) {
                console.error("Gagal menyalin kode: ", err);
            }
            document.body.removeChild(textArea);
        });
    </script>
</body>
</html>

